{"ast":null,"code":"var _jsxFileName = \"/Users/mayankkhanna/Documents/miru-web/app/javascript/src/components/time-tracking/AddEntry.tsx\",\n    _this = this;\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar logger = require(\"js-logger\").get(\"@saeloun/miru-web:javascript:src:components:time-tracking:AddEntry.tsx\");\n\n/* eslint-disable @typescript-eslint/no-var-requires */\nimport React from \"react\";\nimport autosize from \"autosize\";\nimport Toastr from \"common/Toastr\";\nimport validateTimesheetEntry from \"helpers/validateTimesheetEntry\";\nimport timesheetEntryApi from \"../../apis/timesheet-entry\";\nimport { minutesFromHHMM, minutesToHHMM } from \"../../helpers/hhmm-parser\";\nimport { getNumberWithOrdinal } from \"../../helpers/ordinal\";\n\nvar checkedIcon = require(\"../../../../assets/images/checkbox-checked.svg\");\n\nvar uncheckedIcon = require(\"../../../../assets/images/checkbox-unchecked.svg\");\n\nvar AddEntry = function AddEntry(_ref) {\n  var selectedEmployeeId = _ref.selectedEmployeeId,\n      fetchEntries = _ref.fetchEntries,\n      setNewEntryView = _ref.setNewEntryView,\n      clients = _ref.clients,\n      projects = _ref.projects,\n      selectedDateInfo = _ref.selectedDateInfo,\n      entryList = _ref.entryList,\n      selectedFullDate = _ref.selectedFullDate,\n      setEditEntryId = _ref.setEditEntryId,\n      editEntryId = _ref.editEntryId;\n  var useState = React.useState,\n      useEffect = React.useEffect;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      note = _useState2[0],\n      setNote = _useState2[1];\n\n  var _useState3 = useState(\"00:00\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      duration = _useState4[0],\n      setDuration = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      client = _useState6[0],\n      setClient = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      project = _useState8[0],\n      setProject = _useState8[1];\n\n  var _useState9 = useState(0),\n      _useState10 = _slicedToArray(_useState9, 2),\n      projectId = _useState10[0],\n      setProjectId = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      billable = _useState12[0],\n      setBillable = _useState12[1];\n\n  var _useState13 = useState(true),\n      _useState14 = _slicedToArray(_useState13, 2),\n      projectBillable = _useState14[0],\n      setProjectBillable = _useState14[1];\n\n  var handleFillData = function handleFillData() {\n    if (!editEntryId) return;\n    var entry = entryList[selectedFullDate].find(function (entry) {\n      return entry.id === editEntryId;\n    });\n\n    if (entry) {\n      setDuration(minutesToHHMM(entry.duration));\n      setClient(entry.client);\n      setProject(entry.project);\n      setProjectId(entry.project_id);\n      setNote(entry.note);\n      if ([\"unbilled\", \"billed\"].includes(entry.bill_status)) setBillable(true);\n    }\n  };\n\n  useEffect(function () {\n    var textArea = document.querySelector(\"textarea\");\n    autosize(textArea);\n    handleFillData();\n    textArea.click();\n  }, []);\n  useEffect(function () {\n    if (!project) return;\n    var selectedProject = projects[client].find(function (currentProject) {\n      return currentProject.name === project;\n    });\n\n    if (selectedProject) {\n      setProjectId(Number(selectedProject.id));\n      setProjectBillable(selectedProject.billable);\n      setBillable(selectedProject.billable);\n    }\n  }, [project]);\n\n  var handleDurationChange = function handleDurationChange(e) {\n    setDuration(e.target.value);\n  };\n\n  var getPayload = function getPayload() {\n    return {\n      work_date: selectedFullDate,\n      duration: minutesFromHHMM(duration),\n      note: note,\n      bill_status: billable ? \"unbilled\" : \"non_billable\"\n    };\n  };\n\n  var handleSave = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var tse, message, res, fetchEntriesRes;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              tse = getPayload();\n              message = validateTimesheetEntry(tse);\n\n              if (!message) {\n                _context.next = 5;\n                break;\n              }\n\n              Toastr.error(message);\n              return _context.abrupt(\"return\");\n\n            case 5:\n              _context.next = 7;\n              return timesheetEntryApi.create({\n                project_id: projectId,\n                timesheet_entry: tse\n              }, selectedEmployeeId);\n\n            case 7:\n              res = _context.sent;\n\n              if (!(res.status === 200)) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 11;\n              return fetchEntries(selectedFullDate, selectedFullDate);\n\n            case 11:\n              fetchEntriesRes = _context.sent;\n\n              if (fetchEntriesRes) {\n                setNewEntryView(false);\n              }\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSave() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleEdit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var tse, message, res, fetchEntriesRes;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              tse = getPayload();\n              message = validateTimesheetEntry(tse);\n\n              if (!message) {\n                _context2.next = 5;\n                break;\n              }\n\n              Toastr.error(message);\n              return _context2.abrupt(\"return\");\n\n            case 5:\n              _context2.next = 7;\n              return timesheetEntryApi.update(editEntryId, {\n                project_id: projectId,\n                timesheet_entry: tse\n              });\n\n            case 7:\n              res = _context2.sent;\n\n              if (!(res.status === 200)) {\n                _context2.next = 13;\n                break;\n              }\n\n              _context2.next = 11;\n              return fetchEntries(selectedFullDate, selectedFullDate);\n\n            case 11:\n              fetchEntriesRes = _context2.sent;\n\n              if (fetchEntriesRes) {\n                setNewEntryView(false);\n                setEditEntryId(0);\n              }\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleEdit() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"min-h-24 p-4 flex justify-between rounded-lg shadow-2xl \" + (editEntryId ? \"mt-10\" : \"\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-1/2\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-129 mb-2 flex justify-between\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"select\", {\n    onChange: function onChange(e) {\n      setClient(e.target.value);\n      setProject(projects[e.target.value][0].name);\n    },\n    value: client || \"Client\",\n    name: \"client\",\n    id: \"client\",\n    className: \"w-64 bg-miru-gray-100 rounded-sm h-8\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 11\n    }\n  }, !client && /*#__PURE__*/React.createElement(\"option\", {\n    disabled: true,\n    selected: true,\n    className: \"text-miru-gray-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 15\n    }\n  }, \"Client\"), clients.map(function (client, i) {\n    return /*#__PURE__*/React.createElement(\"option\", {\n      key: i.toString(),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 15\n      }\n    }, client[\"name\"]);\n  })), /*#__PURE__*/React.createElement(\"select\", {\n    onChange: function onChange(e) {\n      setProject(e.target.value);\n    },\n    value: project,\n    name: \"project\",\n    id: \"project\",\n    className: \"w-64 bg-miru-gray-100 rounded-sm h-8\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, !project && /*#__PURE__*/React.createElement(\"option\", {\n    disabled: true,\n    selected: true,\n    className: \"text-miru-gray-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  }, \"Project\"), client && projects[client].map(function (project, i) {\n    return /*#__PURE__*/React.createElement(\"option\", {\n      \"data-project-id\": project.id,\n      key: i.toString(),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 15\n      }\n    }, project.name);\n  }))), /*#__PURE__*/React.createElement(\"textarea\", {\n    value: note,\n    onChange: function onChange(e) {\n      return setNote(e.target.value);\n    },\n    rows: 5,\n    cols: 60,\n    name: \"notes\",\n    placeholder: \" Notes\",\n    className: \"w-129 px-1 rounded-sm bg-miru-gray-100 focus:miru-han-purple-1000 outline-none resize-none mt-2 \" + (editEntryId ? \"h-32\" : \"h-8\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-60\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mb-2 flex justify-between\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"p-1 h-8 w-29 bg-miru-gray-100 rounded-sm text-sm flex justify-center items-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, \"\".concat(getNumberWithOrdinal(selectedDateInfo[\"date\"]), \" \").concat(selectedDateInfo[\"month\"], \", \").concat(selectedDateInfo[\"year\"])), /*#__PURE__*/React.createElement(\"input\", {\n    value: duration,\n    onChange: handleDurationChange,\n    type: \"text\",\n    className: \"p-1 h-8 w-29 bg-miru-gray-100 rounded-sm text-sm\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex items-center mt-2\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }\n  }, billable ? /*#__PURE__*/React.createElement(\"img\", {\n    onClick: function onClick() {\n      setBillable(false);\n    },\n    className: \"inline\",\n    src: checkedIcon,\n    alt: \"checkbox\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }) : /*#__PURE__*/React.createElement(\"img\", {\n    onClick: function onClick() {\n      if (projectBillable) setBillable(true);\n    },\n    className: \"inline\",\n    src: uncheckedIcon,\n    alt: \"checkbox\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 11\n    }\n  }, \"Billable\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"max-w-min\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }\n  }, editEntryId === 0 ? /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleSave,\n    className: \"mb-1 h-8 w-38 text-xs py-1 px-6 rounded border text-white font-bold tracking-widest \" + (note && client && project ? \"bg-miru-han-purple-1000 hover:border-transparent\" : \"bg-miru-gray-1000\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 11\n    }\n  }, \"SAVE\") : /*#__PURE__*/React.createElement(\"button\", {\n    onClick: function onClick() {\n      return handleEdit();\n    },\n    className: \"mb-1 h-8 w-38 text-xs py-1 px-6 rounded border text-white font-bold tracking-widest \" + (note && client && project ? \"bg-miru-han-purple-1000 hover:border-transparent\" : \"bg-miru-gray-1000\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 11\n    }\n  }, \"UPDATE\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: function onClick() {\n      setNewEntryView(false);\n      setEditEntryId(0);\n    },\n    className: \"mt-1 h-8 w-38 text-xs py-1 px-6 rounded border border-miru-han-purple-1000 bg-transparent hover:bg-miru-han-purple-1000 text-miru-han-purple-600 font-bold hover:text-white hover:border-transparent tracking-widest\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 9\n    }\n  }, \"CANCEL\")));\n};\n\nexport default AddEntry;","map":{"version":3,"sources":["/Users/mayankkhanna/Documents/miru-web/app/javascript/src/components/time-tracking/AddEntry.tsx"],"names":["React","autosize","Toastr","validateTimesheetEntry","timesheetEntryApi","minutesFromHHMM","minutesToHHMM","getNumberWithOrdinal","checkedIcon","require","uncheckedIcon","AddEntry","selectedEmployeeId","fetchEntries","setNewEntryView","clients","projects","selectedDateInfo","entryList","selectedFullDate","setEditEntryId","editEntryId","useState","useEffect","note","setNote","duration","setDuration","client","setClient","project","setProject","projectId","setProjectId","billable","setBillable","projectBillable","setProjectBillable","handleFillData","entry","find","id","project_id","includes","bill_status","textArea","document","querySelector","click","selectedProject","currentProject","name","Number","handleDurationChange","e","target","value","getPayload","work_date","handleSave","tse","message","error","create","timesheet_entry","res","status","fetchEntriesRes","handleEdit","update","map","i","toString"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-var-requires */\nimport React from \"react\";\nimport autosize from \"autosize\";\nimport Toastr from \"common/Toastr\";\nimport validateTimesheetEntry from \"helpers/validateTimesheetEntry\";\nimport timesheetEntryApi from \"../../apis/timesheet-entry\";\nimport { minutesFromHHMM, minutesToHHMM } from \"../../helpers/hhmm-parser\";\nimport { getNumberWithOrdinal } from \"../../helpers/ordinal\";\nconst checkedIcon = require(\"../../../../assets/images/checkbox-checked.svg\");\nconst uncheckedIcon = require(\"../../../../assets/images/checkbox-unchecked.svg\");\n\nconst AddEntry: React.FC<Iprops> = ({\n  selectedEmployeeId,\n  fetchEntries,\n  setNewEntryView,\n  clients,\n  projects,\n  selectedDateInfo,\n  entryList,\n  selectedFullDate,\n  setEditEntryId,\n  editEntryId\n}) => {\n  const { useState, useEffect } = React;\n  const [note, setNote] = useState(\"\");\n  const [duration, setDuration] = useState(\"00:00\");\n  const [client, setClient] = useState(\"\");\n  const [project, setProject] = useState(\"\");\n  const [projectId, setProjectId] = useState(0);\n  const [billable, setBillable] = useState(false);\n  const [projectBillable, setProjectBillable] = useState(true);\n\n  const handleFillData = () => {\n    if (! editEntryId) return;\n    const entry = entryList[selectedFullDate].find(\n      entry => entry.id === editEntryId\n    );\n    if (entry) {\n      setDuration(minutesToHHMM(entry.duration));\n      setClient(entry.client);\n      setProject(entry.project);\n      setProjectId(entry.project_id);\n      setNote(entry.note);\n      if ([\"unbilled\", \"billed\"].includes(entry.bill_status)) setBillable(true);\n    }\n\n  };\n\n  useEffect(() => {\n    const textArea = document.querySelector(\"textarea\");\n    autosize(textArea);\n    handleFillData();\n    textArea.click();\n  }, []);\n\n  useEffect(() => {\n    if (!project) return;\n    const selectedProject = projects[client].find(\n      currentProject => currentProject.name === project\n    );\n    if (selectedProject) {\n      setProjectId(Number(selectedProject.id));\n      setProjectBillable(selectedProject.billable);\n      setBillable(selectedProject.billable);\n    }\n  }, [project]);\n\n  const handleDurationChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setDuration(e.target.value);\n  };\n\n  const getPayload = () => ({\n    work_date: selectedFullDate,\n    duration: minutesFromHHMM(duration),\n    note: note,\n    bill_status: billable ? \"unbilled\" : \"non_billable\"\n  });\n\n  const handleSave = async () => {\n    const tse = getPayload();\n    const message = validateTimesheetEntry(tse);\n    if (message) {\n      Toastr.error(message);\n      return;\n    }\n    const res = await timesheetEntryApi.create({\n      project_id: projectId,\n      timesheet_entry: tse\n    }, selectedEmployeeId);\n\n    if (res.status === 200) {\n      const fetchEntriesRes = await fetchEntries(selectedFullDate, selectedFullDate);\n      if (fetchEntriesRes) {\n        setNewEntryView(false);\n      }\n    }\n  };\n\n  const handleEdit = async () => {\n    const tse = getPayload();\n    const message = validateTimesheetEntry(tse);\n    if (message) {\n      Toastr.error(message);\n      return;\n    }\n    const res = await timesheetEntryApi.update(editEntryId, {\n      project_id: projectId,\n      timesheet_entry: tse\n    });\n\n    if (res.status === 200) {\n      const fetchEntriesRes = await fetchEntries(selectedFullDate, selectedFullDate);\n      if (fetchEntriesRes) {\n        setNewEntryView(false);\n        setEditEntryId(0);\n      }\n    }\n  };\n\n  return (\n    <div\n      className={\n        \"min-h-24 p-4 flex justify-between rounded-lg shadow-2xl \" +\n        (editEntryId ? \"mt-10\" : \"\")\n      }\n    >\n      <div className=\"w-1/2\">\n        <div className=\"w-129 mb-2 flex justify-between\">\n          <select\n            onChange={e => {\n              setClient(e.target.value);\n              setProject(projects[e.target.value][0].name);\n            }}\n            value={client || \"Client\"}\n            name=\"client\"\n            id=\"client\"\n            className=\"w-64 bg-miru-gray-100 rounded-sm h-8\"\n          >\n            {!client && (\n              <option disabled selected className=\"text-miru-gray-100\">\n              Client\n              </option>\n            )}\n            {clients.map((client, i) => (\n              <option key={i.toString()}>{client[\"name\"]}</option>\n            ))}\n          </select>\n\n          <select\n            onChange={e => {\n              setProject(e.target.value);\n            }}\n            value={project}\n            name=\"project\"\n            id=\"project\"\n            className=\"w-64 bg-miru-gray-100 rounded-sm h-8\"\n          >\n            {!project && (\n              <option disabled selected className=\"text-miru-gray-100\">\n              Project\n              </option>\n            )}\n            {client &&\n            projects[client].map((project, i) => (\n              <option data-project-id={project.id} key={i.toString()}>\n                {project.name}\n              </option>\n            ))}\n          </select>\n        </div>\n        <textarea\n          value={note}\n          onChange={e => setNote(e.target.value)}\n          rows={5}\n          cols={60}\n          name=\"notes\"\n          placeholder=\" Notes\"\n          className={(\"w-129 px-1 rounded-sm bg-miru-gray-100 focus:miru-han-purple-1000 outline-none resize-none mt-2 \" + (editEntryId ? \"h-32\" : \"h-8\") )}\n        ></textarea>\n      </div>\n      <div className=\"w-60\">\n        <div className=\"mb-2 flex justify-between\">\n          <div className=\"p-1 h-8 w-29 bg-miru-gray-100 rounded-sm text-sm flex justify-center items-center\">\n            {`${getNumberWithOrdinal(selectedDateInfo[\"date\"])} ${\n              selectedDateInfo[\"month\"]\n            }, ${selectedDateInfo[\"year\"]}`}\n          </div>\n          <input\n            value={duration}\n            onChange={handleDurationChange}\n            type=\"text\"\n            className=\"p-1 h-8 w-29 bg-miru-gray-100 rounded-sm text-sm\"\n          />\n        </div>\n        <div className=\"flex items-center mt-2\">\n          {billable ? (\n            <img\n              onClick={() => {\n                setBillable(false);\n              }}\n              className=\"inline\"\n              src={checkedIcon}\n              alt=\"checkbox\"\n            />\n          ) : (\n            <img\n              onClick={() => {\n                if (projectBillable) setBillable(true);\n              }}\n              className=\"inline\"\n              src={uncheckedIcon}\n              alt=\"checkbox\"\n            />\n          )}\n          <h4>Billable</h4>\n        </div>\n      </div>\n      <div className=\"max-w-min\">\n        {editEntryId === 0 ? (\n          <button\n            onClick={handleSave}\n            className={\n              \"mb-1 h-8 w-38 text-xs py-1 px-6 rounded border text-white font-bold tracking-widest \" +\n              (note && client && project\n                ? \"bg-miru-han-purple-1000 hover:border-transparent\"\n                : \"bg-miru-gray-1000\")\n            }\n          >\n            SAVE\n          </button>\n        ) : (\n          <button\n            onClick={() => handleEdit()}\n            className={\n              \"mb-1 h-8 w-38 text-xs py-1 px-6 rounded border text-white font-bold tracking-widest \" +\n              (note && client && project\n                ? \"bg-miru-han-purple-1000 hover:border-transparent\"\n                : \"bg-miru-gray-1000\")\n            }\n          >\n            UPDATE\n          </button>\n        )}\n        <button\n          onClick={() => {\n            setNewEntryView(false);\n            setEditEntryId(0);\n          }}\n          className=\"mt-1 h-8 w-38 text-xs py-1 px-6 rounded border border-miru-han-purple-1000 bg-transparent hover:bg-miru-han-purple-1000 text-miru-han-purple-600 font-bold hover:text-white hover:border-transparent tracking-widest\"\n        >\n          CANCEL\n        </button>\n      </div>\n    </div>\n  );\n};\n\ninterface Iprops {\n  selectedEmployeeId: number;\n  fetchEntries: (from: string, to: string) => Promise<any>\n  setNewEntryView: React.Dispatch<React.SetStateAction<boolean>>;\n  clients: any[];\n  projects: object;\n  selectedDateInfo: object;\n  setEntryList: React.Dispatch<React.SetStateAction<object[]>>;\n  entryList: object;\n  selectedFullDate: string;\n  editEntryId: number;\n  setEditEntryId: React.Dispatch<React.SetStateAction<number>>;\n  dayInfo: object;\n}\n\nexport default AddEntry;\n"]},"metadata":{},"sourceType":"module"}