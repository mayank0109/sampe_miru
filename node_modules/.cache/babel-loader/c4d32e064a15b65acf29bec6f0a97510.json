{"ast":null,"code":"var _jsxFileName = \"/Users/mayankkhanna/Documents/miru-web/app/javascript/src/components/Invoices/Edit/index.tsx\",\n    _this = this;\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar logger = require(\"js-logger\").get(\"@saeloun/miru-web:javascript:src:components:Invoices:Edit:index.tsx\");\n\nimport React, { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { setAuthHeaders, registerIntercepts } from \"apis/axios\";\nimport clientsApi from \"apis/clients\";\nimport invoicesApi from \"apis/invoices\";\nimport dayjs from \"dayjs\";\nimport Header from \"./Header\";\nimport InvoiceTable from \"./InvoiceTable\";\nimport InvoiceTotal from \"./InvoiceTotal\";\nimport CompanyInfo from \"../CompanyInfo\";\nimport InvoiceDetails from \"../Generate/InvoiceDetails\";\n\nvar EditInvoice = function EditInvoice() {\n  var navigate = useNavigate();\n  var params = useParams();\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      invoiceDetails = _useState2[0],\n      getInvoiceDetails = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      lineItems = _useState4[0],\n      setLineItems = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      selectedLineItems = _useState6[0],\n      setSelectedLineItems = _useState6[1];\n\n  var _useState7 = useState({\n    value: 0\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      selectedClient = _useState8[0],\n      setSelectedClient = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      invoiceNumber = _useState10[0],\n      setInvoiceNumber = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      _useState12 = _slicedToArray(_useState11, 1),\n      reference = _useState12[0];\n\n  var _useState13 = useState(0),\n      _useState14 = _slicedToArray(_useState13, 2),\n      amount = _useState14[0],\n      setAmount = _useState14[1];\n\n  var _useState15 = useState(0),\n      _useState16 = _slicedToArray(_useState15, 2),\n      amountDue = _useState16[0],\n      setAmountDue = _useState16[1];\n\n  var _useState17 = useState(0),\n      _useState18 = _slicedToArray(_useState17, 1),\n      amountPaid = _useState18[0];\n\n  var _useState19 = useState(0),\n      _useState20 = _slicedToArray(_useState19, 2),\n      discount = _useState20[0],\n      setDiscount = _useState20[1];\n\n  var _useState21 = useState(0),\n      _useState22 = _slicedToArray(_useState21, 2),\n      tax = _useState22[0],\n      setTax = _useState22[1];\n\n  var _useState23 = useState(),\n      _useState24 = _slicedToArray(_useState23, 2),\n      issueDate = _useState24[0],\n      setIssueDate = _useState24[1];\n\n  var _useState25 = useState(),\n      _useState26 = _slicedToArray(_useState25, 2),\n      dueDate = _useState26[0],\n      setDueDate = _useState26[1];\n\n  var addKeyToLineItems = function addKeyToLineItems(items) {\n    return items.map(function (item, index) {\n      item[\"key\"] = index;\n      return item;\n    });\n  };\n\n  var fetchInvoice = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(navigate, getInvoiceDetails) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return invoicesApi.editInvoice(params.id);\n\n            case 3:\n              res = _context.sent;\n              getInvoiceDetails(res.data);\n              setLineItems(addKeyToLineItems(res.data.lineItems));\n              setAmount(res.data.amount);\n              setDiscount(res.data.discount);\n              setSelectedClient(res.data.client);\n              setAmountDue(res.data.amountDue);\n              _context.next = 16;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](0);\n              navigate(\"/invoices/error\");\n              return _context.abrupt(\"return\", {});\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 12]]);\n    }));\n\n    return function fetchInvoice(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fetchNewLineItems = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(navigate, id, setSelectedClient, setLineItems) {\n      var res, _res$data$client, address, phone, email, value, label;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return clientsApi.newInvoiceLineItems(id);\n\n            case 3:\n              res = _context2.sent;\n              _res$data$client = res.data.client, address = _res$data$client.address, phone = _res$data$client.phone, email = _res$data$client.email, value = _res$data$client.id, label = _res$data$client.name;\n              setSelectedClient({\n                address: address,\n                email: email,\n                label: label,\n                phone: phone,\n                value: value\n              });\n              setLineItems(addKeyToLineItems(res.data.lineItems));\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              navigate(\"/invoices/error\");\n              return _context2.abrupt(\"return\", {});\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function fetchNewLineItems(_x3, _x4, _x5, _x6) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    setAuthHeaders();\n    registerIntercepts();\n    fetchInvoice(navigate, getInvoiceDetails);\n  }, []);\n  useEffect(function () {\n    setAuthHeaders();\n    registerIntercepts();\n\n    if (selectedClient.value != 0) {\n      fetchNewLineItems(navigate, selectedClient.value, setSelectedClient, setLineItems);\n    }\n  }, [selectedClient.value]);\n\n  var updateInvoice = function updateInvoice() {\n    invoicesApi.updateInvoice(invoiceDetails.id, {\n      invoice_number: invoiceNumber || invoiceDetails.invoiceNumber,\n      issue_date: dayjs(issueDate || invoiceDetails.issueDate).format(\"DD.MM.YYYY\"),\n      due_date: dayjs(dueDate || invoiceDetails.dueDate).format(\"DD.MM.YYYY\"),\n      amount_due: amountDue || invoiceDetails.amountDue,\n      amount_paid: amountPaid || invoiceDetails.amountPaid,\n      amount: amount,\n      discount: Number(discount),\n      tax: tax || invoiceDetails.tax,\n      client_id: selectedClient.value,\n      invoice_line_items_attributes: selectedLineItems.map(function (item) {\n        return {\n          name: \"\".concat(item.first_name, \" \").concat(item.last_name),\n          description: item.description,\n          date: item.date,\n          rate: item.rate,\n          quantity: item.qty,\n          timesheet_entry_id: item.time_sheet_entry\n        };\n      })\n    }).then(function () {\n      return navigate(\"/invoices/\".concat(invoiceDetails.id));\n    })[\"catch\"]();\n  };\n\n  if (invoiceDetails) {\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      invoiceNumber: invoiceDetails.invoiceNumber,\n      id: invoiceDetails.id,\n      updateInvoice: updateInvoice,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bg-miru-gray-100 mt-5 mb-10 p-0 m-0 w-full\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(CompanyInfo, {\n      company: invoiceDetails.company,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(InvoiceDetails, {\n      currency: invoiceDetails.company.currency,\n      clientList: invoiceDetails.companyClientList,\n      selectedClient: selectedClient || invoiceDetails.client,\n      setSelectedClient: setSelectedClient,\n      amount: amount,\n      dueDate: dueDate || invoiceDetails.dueDate,\n      setDueDate: setDueDate,\n      issueDate: issueDate || invoiceDetails.issueDate,\n      setIssueDate: setIssueDate,\n      invoiceNumber: invoiceNumber || invoiceDetails.invoiceNumber,\n      setInvoiceNumber: setInvoiceNumber,\n      reference: reference,\n      optionSelected: true,\n      clientVisible: false,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"px-10 py-5\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(InvoiceTable, {\n      lineItems: lineItems,\n      setLineItems: setLineItems,\n      selectedLineItems: selectedLineItems,\n      setSelectedLineItems: setSelectedLineItems,\n      items: invoiceDetails.invoiceLineItems,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(InvoiceTotal, {\n      currency: invoiceDetails.company.currency,\n      newLineItems: selectedLineItems,\n      setAmount: setAmount,\n      invoiceAmount: invoiceDetails.amount,\n      amountPaid: amountPaid || invoiceDetails.amountPaid,\n      amountDue: amountDue || invoiceDetails.amountDue,\n      setAmountDue: setAmountDue,\n      discount: discount,\n      setDiscount: setDiscount,\n      tax: tax || invoiceDetails.tax,\n      setTax: setTax,\n      invoiceLineItems: invoiceDetails.invoiceLineItems,\n      showDiscountInput: !!invoiceDetails.discount,\n      showTax: !!invoiceDetails.tax,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }\n    })));\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null);\n};\n\nexport default EditInvoice;","map":{"version":3,"sources":["/Users/mayankkhanna/Documents/miru-web/app/javascript/src/components/Invoices/Edit/index.tsx"],"names":["React","useEffect","useState","useParams","useNavigate","setAuthHeaders","registerIntercepts","clientsApi","invoicesApi","dayjs","Header","InvoiceTable","InvoiceTotal","CompanyInfo","InvoiceDetails","EditInvoice","navigate","params","invoiceDetails","getInvoiceDetails","lineItems","setLineItems","selectedLineItems","setSelectedLineItems","value","selectedClient","setSelectedClient","invoiceNumber","setInvoiceNumber","reference","amount","setAmount","amountDue","setAmountDue","amountPaid","discount","setDiscount","tax","setTax","issueDate","setIssueDate","dueDate","setDueDate","addKeyToLineItems","items","map","item","index","fetchInvoice","editInvoice","id","res","data","client","fetchNewLineItems","newInvoiceLineItems","address","phone","email","label","name","updateInvoice","invoice_number","issue_date","format","due_date","amount_due","amount_paid","Number","client_id","invoice_line_items_attributes","first_name","last_name","description","date","rate","quantity","qty","timesheet_entry_id","time_sheet_entry","then","company","currency","companyClientList","invoiceLineItems"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\n\nimport { setAuthHeaders, registerIntercepts } from \"apis/axios\";\nimport clientsApi from \"apis/clients\";\nimport invoicesApi from \"apis/invoices\";\nimport dayjs from \"dayjs\";\nimport Header from \"./Header\";\nimport InvoiceTable from \"./InvoiceTable\";\nimport InvoiceTotal from \"./InvoiceTotal\";\nimport CompanyInfo from \"../CompanyInfo\";\nimport InvoiceDetails from \"../Generate/InvoiceDetails\";\n\nconst EditInvoice = () => {\n  const navigate = useNavigate();\n  const params = useParams();\n\n  const [invoiceDetails, getInvoiceDetails] = useState<any>();\n  const [lineItems, setLineItems] = useState<any>([]);\n  const [selectedLineItems, setSelectedLineItems] = useState<any>([]);\n  const [selectedClient, setSelectedClient] = useState<any>({ value: 0 });\n  const [invoiceNumber, setInvoiceNumber] = useState<any>(\"\");\n  const [reference] = useState<any>(\"\");\n  const [amount, setAmount] = useState<any>(0);\n  const [amountDue, setAmountDue] = useState<any>(0);\n  const [amountPaid] = useState<any>(0);\n  const [discount, setDiscount] = useState<any>(0);\n  const [tax, setTax] = useState<any>(0);\n  const [issueDate, setIssueDate] = useState();\n  const [dueDate, setDueDate] = useState();\n\n  const addKeyToLineItems = items => (\n    items.map((item, index) => {\n      item[\"key\"] = index;\n      return item;\n    })\n  );\n\n  const fetchInvoice = async (navigate, getInvoiceDetails) => {\n    try {\n      const res = await invoicesApi.editInvoice(params.id);\n\n      getInvoiceDetails(res.data);\n      setLineItems(addKeyToLineItems(res.data.lineItems));\n      setAmount(res.data.amount);\n      setDiscount(res.data.discount);\n      setSelectedClient(res.data.client);\n      setAmountDue(res.data.amountDue);\n    } catch (e) {\n      navigate(\"/invoices/error\");\n      return {};\n    }\n  };\n\n  const fetchNewLineItems = async (navigate, id, setSelectedClient, setLineItems) => {\n    try {\n      const res = await clientsApi.newInvoiceLineItems(id);\n      const { address, phone, email, id: value, name: label } = res.data.client;\n\n      setSelectedClient({ address, email, label, phone, value });\n      setLineItems(addKeyToLineItems(res.data.lineItems));\n    } catch (e) {\n      navigate(\"/invoices/error\");\n      return {};\n    }\n  };\n\n  useEffect(() => {\n    setAuthHeaders();\n    registerIntercepts();\n    fetchInvoice(navigate, getInvoiceDetails);\n  }, []);\n\n  useEffect(() => {\n    setAuthHeaders();\n    registerIntercepts();\n    if (selectedClient.value != 0) {\n      fetchNewLineItems(navigate, selectedClient.value, setSelectedClient, setLineItems);\n    }\n  }, [selectedClient.value]);\n\n  const updateInvoice = () => {\n    invoicesApi.updateInvoice(invoiceDetails.id, {\n      invoice_number: invoiceNumber || invoiceDetails.invoiceNumber,\n      issue_date: dayjs(issueDate || invoiceDetails.issueDate).format(\"DD.MM.YYYY\"),\n      due_date: dayjs(dueDate || invoiceDetails.dueDate).format(\"DD.MM.YYYY\"),\n      amount_due: amountDue || invoiceDetails.amountDue,\n      amount_paid: amountPaid || invoiceDetails.amountPaid,\n      amount: amount,\n      discount: Number(discount),\n      tax: tax || invoiceDetails.tax,\n      client_id: selectedClient.value,\n      invoice_line_items_attributes: selectedLineItems.map(item => ({\n        name: `${item.first_name} ${item.last_name}`,\n        description: item.description,\n        date: item.date,\n        rate: item.rate,\n        quantity: item.qty,\n        timesheet_entry_id: item.time_sheet_entry\n      }))\n    })\n      .then(() => navigate(`/invoices/${invoiceDetails.id}`))\n      .catch();\n  };\n\n  if (invoiceDetails) {\n    return (\n      <React.Fragment>\n        <Header\n          invoiceNumber={invoiceDetails.invoiceNumber}\n          id={invoiceDetails.id}\n          updateInvoice={updateInvoice}\n        />\n        <div className=\"bg-miru-gray-100 mt-5 mb-10 p-0 m-0 w-full\">\n          <CompanyInfo company={invoiceDetails.company} />\n          <InvoiceDetails\n            currency={invoiceDetails.company.currency}\n            clientList={invoiceDetails.companyClientList}\n            selectedClient={selectedClient || invoiceDetails.client}\n            setSelectedClient={setSelectedClient}\n            amount={amount}\n            dueDate={dueDate || invoiceDetails.dueDate}\n            setDueDate={setDueDate}\n            issueDate={issueDate || invoiceDetails.issueDate}\n            setIssueDate={setIssueDate}\n            invoiceNumber={invoiceNumber || invoiceDetails.invoiceNumber}\n            setInvoiceNumber={setInvoiceNumber}\n            reference={reference}\n            optionSelected={true}\n            clientVisible={false}\n          />\n          <div className=\"px-10 py-5\">\n            <InvoiceTable\n              lineItems={lineItems}\n              setLineItems={setLineItems}\n              selectedLineItems={selectedLineItems}\n              setSelectedLineItems={setSelectedLineItems}\n              items={invoiceDetails.invoiceLineItems}\n            />\n          </div>\n          <InvoiceTotal\n            currency={invoiceDetails.company.currency}\n            newLineItems={selectedLineItems}\n            setAmount={setAmount}\n            invoiceAmount={invoiceDetails.amount}\n            amountPaid={amountPaid || invoiceDetails.amountPaid}\n            amountDue={amountDue || invoiceDetails.amountDue}\n            setAmountDue={setAmountDue}\n            discount={discount}\n            setDiscount={setDiscount}\n            tax={tax || invoiceDetails.tax}\n            setTax={setTax}\n            invoiceLineItems={invoiceDetails.invoiceLineItems}\n            showDiscountInput={!!invoiceDetails.discount}\n            showTax={!!invoiceDetails.tax}\n          />\n        </div>\n      </React.Fragment>\n    );\n  }\n  return <></>;\n};\n\nexport default EditInvoice;\n"]},"metadata":{},"sourceType":"module"}